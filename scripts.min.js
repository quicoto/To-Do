(()=>{"use strict";const t="todo__buttonDone",o="todo__loading",n="bg-light",e="todo__post--done",s="todo__post--working",a={counter:`.${"todo__counter"}`,loading:`.${o}`,newPostContent:`.${"todo__newPostContent"}`,newPostForm:`.${"todo__newPostForm"}`,newPostSubmitButton:`.${"todo__newPostSubmitButton"}`,postsContainer:`.${"todo__postsContainer"}`,refreshListButton:`.${"todo__refreshListButton"}`,homeUrlLink:".site-title a"};function d(t,s){let a="",d=n;var r,i;return t.todo__done&&(d=e),a+=`\n  <article class="todo__post position-relative row ${d} p-3 mb-3" data-postid="${t.ID}">\n    <div class="${o}">${s.innerHTML}</div>\n    ${function(t){let o="";return t&&(o=`<div class="col-12"><h3>${t}</h3></div>`),o}(t.post_title)}\n    ${i=t.post_date,`<div class="col-12"><small>${i}</small></div>`}\n    ${function(t){return`<div class="col-12 mb-3 todo__postContent">${t.replace(/\n/g,"<br />")}</div>`}(t.post_content)}\n    ${r=t.ID,`\n  <div\n    class="todo__postActions col-12 col-sm-6 offset-sm-6 col-md-4 offset-md-8 col-lg-3 offset-lg-9 text-right"\n    >\n    <button\n      data-postid="${r}"\n      type="button"\n      class="btn btn-success btn-block todo__buttonDone">\n        Mark as done\n      </button>\n  </div>`}\n  </article>\n`,a}!function(){const o={counterTodo:0,counterTotal:0},r={};function i(t){if(t.logged_out){const t=document.querySelector(a.homeUrlLink);t&&(window.location=t.getAttribute("href"))}}function c(){r.counter.innerHTML=`<h3 class="d-flex justify-content-between">\n    <div>To do: <span class="todo__counterTodo">${o.counterTodo}</span></div>\n    <div>Total: <span class="todo__counterTotal">${o.counterTotal}</span></div>\n  </h3>`}function l(){let t="";const n=new FormData;o.counterTodo=0,r.loading.removeAttribute("hidden"),n.append("action","todo_all_posts"),n.append("nonce",todo_main_ajax.nonce),fetch(todo_main_ajax.ajax_url,{method:"POST",credentials:"same-origin",body:n}).then((t=>t.json())).then((n=>{i(n),n.forEach((n=>{t+=d(n,r.loading),n.todo__done||(o.counterTodo+=1)})),o.counterTotal=n.length,c(),r.postsContainer.innerHTML=t,r.loading.setAttribute("hidden",!0)})).catch((t=>{console.log("[To Do - All Posts]",t),i({logged_out:!0})}))}r.loading=document.querySelector(a.loading),r.newPostForm=document.querySelector(a.newPostForm),r.newPostSubmitButton=document.querySelector(a.newPostSubmitButton),r.postsContainer=document.querySelector(a.postsContainer),r.refreshListButton=document.querySelector(a.refreshListButton),r.counter=document.querySelector(a.counter),r.newPostForm&&(r.newPostForm&&r.newPostForm.addEventListener("submit",(function(t){const n=new FormData;return t.preventDefault(),r.newPostSubmitButton.setAttribute("disabled",!0),r.loading.removeAttribute("hidden"),r.newPostContent=document.querySelector(a.newPostContent),n.append("action","todo_create_post"),n.append("nonce",todo_main_ajax.nonce),n.append("post_content",r.newPostContent.value),fetch(todo_main_ajax.ajax_url,{method:"POST",credentials:"same-origin",body:n}).then((t=>t.json())).then((t=>{i(t),o.counterTodo+=1,o.counterTotal+=1,c(),function(t){const o=d(t,r.loading);r.postsContainer.innerHTML=`${o}${r.postsContainer.innerHTML}`}(t),r.loading.setAttribute("hidden",!0),r.newPostForm.reset(),r.newPostSubmitButton.removeAttribute("disabled")})).catch((t=>{console.log("[To Do - Create Post]",t),i({logged_out:!0})})),!1})),r.postsContainer&&r.postsContainer.addEventListener("click",(function(a){if(!a.target.classList.contains(t))return!1;a.preventDefault(),a.target.setAttribute("disabled",!0);const d=+a.target.dataset.postid,r=document.querySelector(`[data-postid="${d}"]`),l=new FormData;return l.append("action","todo_post_done"),l.append("nonce",todo_main_ajax.nonce),l.append("post_id",d),r.classList.add(s),fetch(todo_main_ajax.ajax_url,{method:"POST",credentials:"same-origin",body:l}).then((t=>t.json())).then((t=>{i(t),r&&(r.classList.remove(s),r.classList.remove(n),r.classList.add(e)),o.counterTodo-=1,c()})).catch((t=>{console.log("[To Do - Post Done]",t),i({logged_out:!0})})),!0})),r.refreshListButton&&r.refreshListButton.addEventListener("click",l),l())}()})();